<script>
    // Configurações mantidas
    const USDC_ADDRESS = "0x3600000000000000000000000000000000000000"; 
    const VAULT_ADDRESS = "0x0000006a50a9c9efae8875266fb8538740f90e66";

    // ... (restante do código v3.0 preservado)

    document.getElementById('depositBtn').onclick = async () => {
        const amt = document.getElementById('opAmount').value;
        if (!amt || parseFloat(amt) <= 0) return;

        try {
            const erc20Abi = ["function approve(address spender, uint256 amount) public returns (bool)"];
            const vaultAbi = ["function deposit(uint256 amount) public returns (bool)"];
            
            const usdcContract = new ethers.Contract(USDC_ADDRESS, erc20Abi, signer);
            const vaultContract = new ethers.Contract(VAULT_ADDRESS, vaultAbi, signer);
            const amountWei = ethers.utils.parseUnits(amt, 6);

            addLog(`Iniciando fluxo de capital: ${amt} USDC...`);

            // PASSO 1: APPROVE
            const approveTx = await usdcContract.approve(VAULT_ADDRESS, amountWei);
            addLog("Aguardando permissão da rede ARC...");
            await approveTx.wait();

            // PASSO 2: DEPOSIT COM ESTIMATIVA DE GÁS
            // Adicionamos gasLimit para forçar a carteira a ler a transação corretamente
            addLog("Executando transferência para o Vault...");
            const depositTx = await vaultContract.deposit(amountWei, {
                gasLimit: 150000 
            });
            
            addLog("Sincronizando com a Blockchain...");
            await depositTx.wait();

            addLog("Sucesso Total! O seu saldo irá atualizar em breve.");
            
            // Verificação dupla do saldo real
            setTimeout(updateRealBalance, 2000);
            setTimeout(updateRealBalance, 5000); // Segunda verificação por segurança
            
        } catch (err) {
            console.error(err);
            addLog("Erro na transação. Verifique se tem ARC para o gás.");
        }
    };
</script>
